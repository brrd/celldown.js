/*
	celldown.js - version 0.0.4
*/
(function(){var a;a=function(){var a,b,c,d,e,f,g,h,i,j;return e={header:!0,rows:3,cols:2,extraPipes:!0,extraSpaces:!0},f=function(a){var b;return b=a.match(/\|/g),null==b?0:b.length},h=function(a){var b,c,d,e,g,h,i;if(g=a.split("\n"),b=/^[\s-:|]+$/.test(g[1]),g.length<2||!b)return!1;for(c=0,d=g.length;d>c;c++){if(e=g[c],h=f(e),0===h||"undefined"!=typeof i&&null!==i&&h!==i)return!1;i=h}return!0},i=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;for(d=function(a,b,c,d){var e;return 0===c?0:(e=b+c,e<=d.ch?-c:b<d.ch&&e>d.ch?-(d.ch-b):0)},l=function(a,b,c){var e,f,g;if(f=/^\s*\||\|\s*$/g,(null!=c?c.line:void 0)===b){for(e=0;null!=(g=f.exec(a));)e+=d(a,g.index,g[0].length,c);c.ch+=e}return a.replace(f,"")},o=function(a,b,c){var e,f,g,h,i;if(f=/(\s*)\|(\s*)/g,(null!=c?c.line:void 0)===b){for(e=0;null!=(g=f.exec(a));)i=g[1],e+=d(a,g.index,i.length,c),h=g[2],e+=d(a,g.index+i.length+1,h.length,c);c.ch+=e}return a.replace(f,"|")},k=a.split("\n"),e=1,n=/^\s?\|.*\|\s?$/.test(k[e]),c=[],f=g=0,h=k.length;h>g;f=++g)i=k[f],n&&(j=l(i,f,b)),j=o(j,f,b),m=j.split("|"),c.push(m);return{arr:c,cursor:b}},d=function(a,b,c,d){var f,g,h,i,j,k;return null==c&&(c=e.extraPipes),null==d&&(d=e.extraSpaces),g=null!=b?b.get(c,d):void 0,null==g&&(g=null),f=d?" | ":"|",c&&d?(h="| ",i=" |"):h=i=c?"|":"",k=function(){var b,c,d;for(d=[],b=0,c=a.length;c>b;b++)j=a[b],d.push(h+j.join(f)+i);return d}().join("\n"),{table:k,cursor:g}},g=function(a,b){var c,d;return c=function(){var b,c,d;for(d=[],b=1,c=a;c>=1?c>=b:b>=c;c>=1?b++:b--)d.push("   ");return d}(),d=function(){var b,c,d;for(d=[],b=1,c=a;c>=1?c>=b:b>=c;c>=1?b++:b--)d.push("---");return d}(),[c,d].concat(function(){var a,d,e;for(e=[],a=1,d=b;d>=1?d>=a:a>=d;d>=1?a++:a--)e.push(c);return e}())},b=function(){function b(b){var c,d,e;c=null!=(d=b.cursor)?d:null,null!=b.text?(h(b.text)||console.error("String is not recognized as a valid markdown table."),e=i(b.text,c),this.arr=e.arr,c=e.cursor):null!=b.cols&&null!=b.rows&&(this.arr=g(b.cols,b.rows)),this.cursor=null!=c?new a(this,c):null}return b.prototype.eachRow=function(a){var b,c,d,e,f;for(e=this.arr,b=c=0,d=e.length;d>c;b=++c)f=e[b],a(this.arr,f,b);return this},b.prototype.eachCell=function(a){return this.eachRow(function(b,c,d){var e,f,g,h,i;for(i=[],f=g=0,h=c.length;h>g;f=++g)e=c[f],i.push(a(this.arr,e,d,f));return i}),this},b.prototype.addRows=function(a,b){var c,d,e,f;if(null==b)b=1;else if(0>=b)return this;return f=this.getSize(),null==a&&(a=null!=(c=this.cursor)?null!=c.row?c.row:c.row=0:void 0),a>f.rows&&(a=f.rows),1>=a&&(a=2),e=function(){var a,b,c;for(c=[],a=1,b=f.cols;b>=1?b>=a:a>=b;b>=1?a++:a--)c.push("   ");return c}(),this.arr.splice(a,0,e),null!=(d=this.cursor)&&d.moveRow(a),b>1&&this.addRows(a,b-1),this},b.prototype.addCols=function(a,b){var c,d;if(null==b)b=1;else if(0>=b)return this;return null==a&&(a=null!=(c=this.cursor)?null!=c.col?c.col:c.col=0:void 0),this.eachRow(function(b,c,d){var e,f;return f=a>c.length?c.length:a,e=1===d?"---":"   ",c.splice(f,0,e)}),null!=(d=this.cursor)&&d.moveCol(a),b>1&&this.addCols(a,b-1),this},b.prototype.removeRows=function(a,b){var c,d,e;if(null==b)b=1;else if(0>=b)return this;return e=this.getSize(),null==a&&(a=null!=(c=this.cursor)?null!=c.row?c.row:c.row=null:void 0),null==a||1>=a||a>e.rows-1?this:(b>e.rows-a&&(b=e.rows-a),this.arr.splice(a,b),null!=this.cursor&&(a<=(d=this.cursor.row)&&a+b-1>=d&&(this.cursor.ch=0),this.cursor.moveRow(a,-b)),this)},b.prototype.removeCols=function(a,b){var c,d,e,f,g,h,i;if(null==b)b=1;else if(0>=b)return this;if(i=this.getSize(),null==a&&(a=null!=(e=this.cursor)?null!=e.col?e.col:e.col=null:void 0),null==a||0>a||a>i.cols-1)return this;for(b>i.cols-a&&(b=i.cols-a),f=this.arr,c=0,d=f.length;d>c;c++)h=f[c],h.splice(a,b);return null!=this.cursor&&(a<=(g=this.cursor.col)&&a+b-1>=g&&(this.cursor.ch=0),this.cursor.moveCol(a,-b)),this},b.prototype.align=function(a,b){var c,d,e,f,g;if(null==a&&(a=null!=(f=this.cursor)?null!=f.col?f.col:f.col=null:void 0),null==a||0>a||a>this.arr.length-1)return this;for(c=this.arr[1][a],d="",e=1,g=c.length-2;g>=1?g>=e:e>=g;g>=1?e++:e--)d+="-";switch(b){case"left":d=":"+d+"-";break;case"right":d="-"+d+":";break;case"center":d=":"+d+":";break;default:d="-"+d+"-"}return this.arr[1][a]=d,this},b.prototype.beautify=function(){var a,b;return a=function(a){return function(){var b,c,d,e,f,g;for(b=[],f=3,a.eachCell(function(a,c,d,e){var f;if(1!==d)return f=c.trim().length,!b[e]||b[e]<f?b[e]=f:void 0}),c=d=0,e=b.length;e>d;c=++d)g=b[c],f>g&&(b[c]=f);return b}}(this),b=function(a){return function(b){return a.eachCell(function(c,d,e,f){var g,h,i,j,k,l,m,n;return null!=a.cursor&&a.cursor.row===e&&a.cursor.col===f&&(g=null!=a.cursor.ch?d.substr(0,a.cursor.ch):d,k=g.match(/^\s?/),null!=k&&(m=k[0].length,a.cursor.ch=m>a.cursor.ch?0:a.cursor.ch-m)),d=d.trim(),n=b[f],i=1===e,i?(h=d.substr(0,1),j=d.substr(-1,1),d=h+function(){var a,b,c;for(c=[],a=1,b=n-2;b>=1?b>=a:a>=b;b>=1?a++:a--)c.push("-");return c}().join("")+j):(l=n-d.length,l>0&&(d+=function(){var a,b,c;for(c=[],a=1,b=l;b>=1?b>=a:a>=b;b>=1?a++:a--)c.push(" ");return c}().join(""))),a.arr[e][f]=d})}}(this),b(a()),this},b.prototype.get=function(a,b){return d(this.arr,this.cursor)},b.prototype.getSize=function(){return{cols:this.arr[0].length,rows:this.arr.length}},b}(),j=function(a,b){var c,d,e,g,h,i,j;return j=b.split("\n"),i=null!=a.line&&a.line<j.length?a.line:null,h=null!=i?j[i]:j[j.length-1],c=null!=a.ch?h.substr(0,a.ch):h,e=f(c),g=c.match(/\|[^|]*$/),d=null!=g?g[0].length:0,{row:i,col:e,ch:d}},a=function(){function a(a,b){var c,d;this.table=a,d=function(){var b,d,e,f;for(e=a.arr,f=[],b=0,d=e.length;d>b;b++)c=e[b],f.push(c.join("|"));return f}().join("\n"),b=j(b,d),this.row=b.row,this.col=b.col,this.ch=b.ch}return a.prototype.moveCol=function(a,b){var c;return null==a&&(a=0),null==b&&(b=1),a<=this.col&&(c=this.table.arr[this.row].length-1,this.col=function(){switch(!1){case!(this.col+b>c):return c;case!(this.col+b<0):return 0;default:return this.col+b}}.call(this)),this},a.prototype.moveRow=function(a,b){var c;return null==a&&(a=0),null==b&&(b=1),a<=this.row&&(c=this.table.arr.length-1,this.row=function(){switch(!1){case!(this.row+b>c):return c;case!(this.row+b<0):return 0;default:return this.row+b}}.call(this)),this},a.prototype.get=function(a,b){var c,d,e,f,g,h,i,j;if(c=this.table.arr,i=null!=(g=c[this.row])?g:c[c.length-1],e=this.ch,this.col>0)for(d=f=0,h=this.col-1;h>=0?h>=f:f>=h;d=h>=0?++f:--f)e+=i[d].length;return a&&(e+=1),j=b?3:1,e+=this.col*j,{line:this.row,ch:e}},a}(),c={"new":function(a,c,d){return null==a&&(a=e.cols),null==c&&(c=e.rows),new b({cols:a,rows:c,cursor:d})},fromText:function(a,c){return new b({text:a,cursor:c})},isValidTable:function(a){return h(a)},isInstanceOfTable:function(a){return a instanceof b},isInstanceOfCursor:function(b){return b instanceof a}}}(),"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=a:"function"==typeof define&&define.amd?define([],function(){return a}):window.celldown=a}).call(this);